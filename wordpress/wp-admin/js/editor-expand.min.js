window.wp=window.wp||{},jQuery(document).ready(function(s){var l,e,f=s(window),c=s(document),u=s("#wpadminbar"),H=s("#wpfooter"),d=s("#postdivrich"),m=s("#wp-content-wrap"),b=s("#wp-content-editor-tools"),x=s(),B=s(),T=s("#ed_toolbar"),y=s("#content"),v=s('<div id="content-textarea-clone"></div>'),C=s("#post-status-info"),O=s(),S=s(),z=s("#side-sortables"),E=s("#postbox-container-1"),A=s("#post-body"),R=window.wp.editor&&window.wp.editor.fullscreen,h=function(){},p=function(){},Y=!1,P=!1,W=!1,k=!1,U=0,X=56,F=20,K=300,o=window.getUserSetting("editor"),L={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};function t(t){var e,o,i,n=jQuery.ui.keyCode,s=t.keyCode,d=document.createRange(),a=y[0].selectionStart,h=y[0].selectionEnd,p=v[0].firstChild;if(!a||!h||a===h){try{d.setStart(p,a),d.setEnd(p,h+1)}catch(t){}(i=d.getBoundingClientRect()).height&&(o=(e=i.top-10)+i.height+10,t=L.adminBarHeight+L.toolsHeight+L.textTopHeight,i=L.windowHeight-L.bottomHeight,e<t&&(s===n.UP||s===n.LEFT||s===n.BACKSPACE)?window.scrollTo(window.pageXOffset,e+window.pageYOffset-t):i<o&&window.scrollTo(window.pageXOffset,o+window.pageYOffset-i))}}function N(){var t,e;l&&!l.isHidden()||!l&&"tinymce"===o||(t=y.height(),v.width(y.width()-22),v.text(y.val()+"&nbsp;"),(e=(e=v.height())<K?K:e)!==t&&(y.height(e),r()))}function r(t){var e,o,i,n,s,d,a,h,p,r,w,g;R&&R.settings.visible||(e=f.scrollTop(),o="scroll"!==t,i=l&&!l.isHidden(),n=K,s=A.offset().top,d=m.width(),!o&&L.windowHeight||(g=f.width(),(L={windowHeight:f.height(),windowWidth:g,adminBarHeight:600<g?u.outerHeight():0,toolsHeight:b.outerHeight()||0,menuBarHeight:O.outerHeight()||0,visualTopHeight:x.outerHeight()||0,textTopHeight:T.outerHeight()||0,bottomHeight:C.outerHeight()||0,statusBarHeight:S.outerHeight()||0,sideSortablesHeight:z.height()||0}).menuBarHeight<3&&(L.menuBarHeight=0)),i||"resize"!==t||N(),r=i?(a=x,w=B,L.visualTopHeight):(a=T,w=y,L.textTopHeight),g=a.parent().offset().top,t=w.offset().top,w=w.outerHeight(),(i?K+r:K+20)+5<w?((!Y||o)&&e>=g-L.toolsHeight-L.adminBarHeight&&e<=g-L.toolsHeight-L.adminBarHeight+w-n?(Y=!0,b.css({position:"fixed",top:L.adminBarHeight,width:d}),i&&O.length&&O.css({position:"fixed",top:L.adminBarHeight+L.toolsHeight,width:d-2-(i?0:a.outerWidth()-a.width())}),a.css({position:"fixed",top:L.adminBarHeight+L.toolsHeight+L.menuBarHeight,width:d-2-(i?0:a.outerWidth()-a.width())})):(Y||o)&&(e<=g-L.toolsHeight-L.adminBarHeight?(Y=!1,b.css({position:"absolute",top:0,width:d}),i&&O.length&&O.css({position:"absolute",top:0,width:d-2}),a.css({position:"absolute",top:L.menuBarHeight,width:d-2-(i?0:a.outerWidth()-a.width())})):e>=g-L.toolsHeight-L.adminBarHeight+w-n&&(Y=!1,b.css({position:"absolute",top:w-n,width:d}),i&&O.length&&O.css({position:"absolute",top:w-n,width:d-2}),a.css({position:"absolute",top:w-n+L.menuBarHeight,width:d-2-(i?0:a.outerWidth()-a.width())}))),(!P||o)&&e+L.windowHeight<=t+w+L.bottomHeight+L.statusBarHeight+1?(P=!0,S.css({position:"fixed",bottom:L.bottomHeight,width:d-2}),C.css({position:"fixed",bottom:0,width:d})):(P||o)&&e+L.windowHeight>t+w+L.bottomHeight+L.statusBarHeight-1&&(P=!1,S.add(C).attr("style",""))):o&&(b.css({position:"absolute",top:0,width:d}),i&&O.length&&O.css({position:"absolute",top:0,width:d-2}),a.css({position:"absolute",top:L.menuBarHeight,width:d-2-(i?0:a.outerWidth()-a.width())}),S.add(C).attr("style","")),E.width()<300&&600<L.windowWidth&&c.height()>z.height()+s+120&&L.windowHeight<w?(L.sideSortablesHeight+X+F>L.windowHeight||W||k?e+X<=s?(z.attr("style",""),W=k=!1):U<e?W?(W=!1,h=z.offset().top-L.adminBarHeight,(p=H.offset().top)<h+L.sideSortablesHeight+F&&(h=p-L.sideSortablesHeight-12),z.css({position:"absolute",top:h,bottom:""})):!k&&L.sideSortablesHeight+z.offset().top+F<e+L.windowHeight&&(k=!0,z.css({position:"fixed",top:"auto",bottom:F})):e<U&&(k?(k=!1,h=z.offset().top-F,(p=H.offset().top)<h+L.sideSortablesHeight+F&&(h=p-L.sideSortablesHeight-12),z.css({position:"absolute",top:h,bottom:""})):!W&&z.offset().top>=e+X&&(W=!0,z.css({position:"fixed",top:X,bottom:""}))):(s-X<=e?z.css({position:"fixed",top:X}):z.attr("style",""),W=k=!1),U=e):(z.attr("style",""),W=k=!1),o&&(m.css({paddingTop:L.toolsHeight}),i?B.css({paddingTop:L.visualTopHeight+L.menuBarHeight}):(y.css({marginTop:L.textTopHeight}),v.width(d-20-2))))}function i(){N(),r()}function w(t){for(var e=1;e<6;e++)setTimeout(t,500*e)}function n(){window.pageYOffset&&130<window.pageYOffset&&window.scrollTo(window.pageXOffset,0),d.addClass("wp-editor-expand"),f.on("scroll.editor-expand resize.editor-expand",function(t){r(t.type),clearTimeout(e),e=setTimeout(r,100)}),c.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",r).on("postbox-toggled.editor-expand",function(){!W&&!k&&window.pageYOffset>X&&(k=!0,window.scrollBy(0,-1),r(),window.scrollBy(0,1)),r()}).on("wp-window-resized.editor-expand",function(){l&&!l.isHidden()?l.execCommand("wpAutoResize"):N()}),y.on("focus.editor-expand input.editor-expand propertychange.editor-expand",N),y.on("keyup.editor-expand",t),h(),R&&R.pubsub.subscribe("hidden",i),l&&(l.settings.wp_autoresize_on=!0,l.execCommand("wpAutoResizeOn"),l.isHidden()||l.execCommand("wpAutoResize")),l&&!l.isHidden()||N(),r()}function a(){var t=window.getUserSetting("ed_size");window.pageYOffset&&130<window.pageYOffset&&window.scrollTo(window.pageXOffset,0),d.removeClass("wp-editor-expand"),f.off(".editor-expand"),c.off(".editor-expand"),y.off(".editor-expand"),p(),R&&R.pubsub.unsubscribe("hidden",i),s.each([x,T,b,O,C,S,m,B,y,z],function(t,e){e&&e.attr("style","")}),Y=P=W=k=!1,l&&(l.settings.wp_autoresize_on=!1,l.execCommand("wpAutoResizeOff"),l.isHidden()||(y.hide(),t&&l.theme.resizeTo(null,t))),t&&y.height(t)}v.insertAfter(y),v.css({"font-family":y.css("font-family"),"font-size":y.css("font-size"),"line-height":y.css("line-height"),"white-space":"pre-wrap","word-wrap":"break-word"}),c.on("tinymce-editor-init.editor-expand",function(t,a){var e=_.debounce(function(){s(".mce-floatpanel:hover").length||tinymce.ui.FloatPanel.hideAll(),s(".mce-tooltip").hide()},1e3,!0);function o(t){var e,o,i,n=tinymce.util.VK,s=t.keyCode,d=(i=a.selection.getNode(),!!(i=(a.plugins.wpview&&(o=a.plugins.wpview.getView(i))?o:i).getBoundingClientRect()).height&&i);d&&(s<=47&&s!==n.SPACEBAR&&s!==n.ENTER&&s!==n.DELETE&&s!==n.BACKSPACE&&s!==n.UP&&s!==n.LEFT&&s!==n.DOWN&&s!==n.UP||91<=s&&s<=93||112<=s&&s<=123||144===s||145===s||(t=(e=d.top+a.iframeElement.getBoundingClientRect().top)+d.height,e-=10,t+=10,o=L.adminBarHeight+L.toolsHeight+L.menuBarHeight+L.visualTopHeight,(i=L.windowHeight-L.bottomHeight-L.statusBarHeight)-o<d.height||(e<o&&(s===n.UP||s===n.LEFT||s===n.BACKSPACE)?window.scrollTo(window.pageXOffset,e+window.pageYOffset-o):i<t&&window.scrollTo(window.pageXOffset,t+window.pageYOffset-i))))}function i(){f.on("scroll.mce-float-panels",e),setTimeout(function(){a.execCommand("wpAutoResize"),r()},300)}function n(){f.off("scroll.mce-float-panels"),setTimeout(function(){var t=m.offset().top;window.pageYOffset>t&&window.scrollTo(window.pageXOffset,t-L.adminBarHeight),N(),r()},100),r()}"content"===a.id&&((l=a).settings.autoresize_min_height=K,x=m.find(".mce-toolbar-grp"),B=m.find(".mce-edit-area"),S=m.find(".mce-statusbar"),O=m.find(".mce-menubar"),h=function(){a.on("keyup",o),a.on("show",i),a.on("hide",n),a.on("setcontent wp-autoresize wp-toolbar-toggle",r),f.off("scroll.mce-float-panels").on("scroll.mce-float-panels",e)},p=function(){a.off("keyup",o),a.off("show",i),a.off("hide",n),a.off("setcontent wp-autoresize wp-toolbar-toggle",r),f.off("scroll.mce-float-panels")},d.hasClass("wp-editor-expand")&&(h(),w(r)))}),d.hasClass("wp-editor-expand")&&(n(),m.hasClass("html-active")&&w(function(){r(),N()})),s("#adv-settings .editor-expand").show(),s("#editor-expand-toggle").on("change.editor-expand",function(){s(this).prop("checked")?(n(),window.setUserSetting("editor_expand","on")):(a(),window.setUserSetting("editor_expand","off"))}),window.editorExpand={on:n,off:a}});