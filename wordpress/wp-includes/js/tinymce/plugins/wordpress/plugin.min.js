tinymce.ui.FloatPanel.zIndex=100100,tinymce.PluginManager.add("wordpress",function(a){var d,e,t,i=tinymce.DOM,n=0;function o(n){var e,o=0,t="hide"===n;!(e=a.theme.panel?a.theme.panel.find(".toolbar:not(.menubar)"):e)||e.length<2||"hide"===n&&!e[1].visible()||(!n&&e[1].visible()&&(n="hide"),tinymce.each(e,function(e,t){0<t&&("hide"===n?(e.hide(),o+=30):(e.show(),o-=30))}),o&&!t&&(tinymce.Env.iOS||(t=a.getContentAreaContainer().firstChild,i.setStyle(t,"height",t.clientHeight+o)),"hide"===n?(setUserSetting("hidetb","0"),d&&d.active(!1)):(setUserSetting("hidetb","1"),d&&d.active(!0))),a.fire("wp-toolbar-toggle"))}function r(){i.hide(i.select("#wp_editbtns, #wp_gallerybtns"))}return a.addButton("wp_adv",{tooltip:"Toolbar Toggle",cmd:"WP_Adv",onPostRender:function(){(d=this).active("1"===getUserSetting("hidetb"))}}),a.on("PostRender",function(){a.getParam("wordpress_adv_hidden",!0)&&"0"===getUserSetting("hidetb","0")&&o("hide")}),a.addCommand("WP_Adv",function(){o()}),a.on("focus",function(){window.wpActiveEditor=a.id}),a.on("BeforeSetContent",function(e){var n;e.content&&(-1!==e.content.indexOf("\x3c!--more")&&(n=a.editorManager.i18n.translate("Read more..."),e.content=e.content.replace(/<!--more(.*?)-->/g,function(e,t){return'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+t+'" class="wp-more-tag mce-wp-more" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==e.content.indexOf("\x3c!--nextpage--\x3e")&&(n=a.editorManager.i18n.translate("Page break"),e.content=e.content.replace(/<!--nextpage-->/g,'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />')),-1!==e.content.indexOf('<?"')&&(e.content=e.content.replace(/<\?"/g,"")))}),a.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,n="";return-1!==e.indexOf('data-wp-more="more"')?e="\x3c!--more"+(n=(t=e.match(/data-wp-more-text="([^"]+)"/))?t[1]:n)+"--\x3e":-1!==e.indexOf('data-wp-more="nextpage"')&&(e="\x3c!--nextpage--\x3e"),e}))}),a.on("ResolveName",function(e){var t;"IMG"===e.target.nodeName&&(t=a.dom.getAttrib(e.target,"data-wp-more"))&&(e.name=t)}),a.addCommand("WP_More",function(e){var t,n="wp-more-tag",o=a.dom,d=a.selection.getNode();n+=" mce-wp-"+(e=e||"more"),t="more"===e?"Read more...":"Next page",t=a.editorManager.i18n.translate(t),e='<img src="'+tinymce.Env.transparentSrc+'" title="'+t+'" class="'+n+'" data-wp-more="'+e+'" data-mce-resize="false" data-mce-placeholder="1" />',"BODY"===d.nodeName||"P"===d.nodeName&&"BODY"===d.parentNode.nodeName?a.insertContent(e):(d=o.getParent(d,function(e){return!(!e.parentNode||"BODY"!==e.parentNode.nodeName)},a.getBody()))&&("P"===d.nodeName?d.appendChild(o.create("p",null,e).firstChild):o.insertAfter(o.create("p",null,e),d),a.nodeChanged())}),a.addCommand("WP_Code",function(){a.formatter.toggle("code")}),a.addCommand("WP_Page",function(){a.execCommand("WP_More","nextpage")}),a.addCommand("WP_Help",function(){a.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",title:"Keyboard Shortcuts",width:450,height:420,inline:1,classes:"wp-help"})}),a.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(a.id)}),a.addButton("wp_more",{tooltip:"Insert Read More tag",onclick:function(){a.execCommand("WP_More","more")}}),a.addButton("wp_page",{tooltip:"Page break",onclick:function(){a.execCommand("WP_More","nextpage")}}),a.addButton("wp_help",{tooltip:"Keyboard Shortcuts",cmd:"WP_Help"}),a.addButton("wp_code",{tooltip:"Code",cmd:"WP_Code",stateSelector:"code"}),"undefined"!=typeof wp&&wp.media&&wp.media.editor&&a.addMenuItem("add_media",{text:"Add Media",icon:"wp-media-library",context:"insert",cmd:"WP_Medialib"}),a.addMenuItem("wp_more",{text:"Insert Read More tag",icon:"wp_more",context:"insert",onclick:function(){a.execCommand("WP_More","more")}}),a.addMenuItem("wp_page",{text:"Page break",icon:"wp_page",context:"insert",onclick:function(){a.execCommand("WP_More","nextpage")}}),a.on("BeforeExecCommand",function(e){!tinymce.Env.webkit||"InsertUnorderedList"!==e.command&&"InsertOrderedList"!==e.command||(t=t||a.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}"),a.getDoc().head.appendChild(t))}),a.on("ExecCommand",function(e){tinymce.Env.webkit&&t&&("InsertUnorderedList"===e.command||"InsertOrderedList"===e.command)&&a.dom.remove(t)}),a.on("init",function(){var e=tinymce.Env,t=["mceContentBody"],n=a.getDoc(),o=a.dom;tinymce.Env.iOS&&o.addClass(n.documentElement,"ios"),"rtl"===a.getParam("directionality")&&(t.push("rtl"),o.setAttrib(n.documentElement,"dir","rtl")),e.ie?9===parseInt(e.ie,10)?t.push("ie9"):8===parseInt(e.ie,10)?t.push("ie8"):e.ie<8&&t.push("ie7"):e.webkit&&t.push("webkit"),t.push("wp-editor"),tinymce.each(t,function(e){e&&o.addClass(n.body,e)}),a.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),e.content=e.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))}),void 0!==window.jQuery&&window.jQuery(document).triggerHandler("tinymce-editor-init",[a]),window.tinyMCEPreInit&&window.tinyMCEPreInit.dragDropUpload&&o.bind(n,"dragstart dragend dragover drop",function(e){void 0!==window.jQuery&&window.jQuery(document).trigger(new window.jQuery.Event(e))}),a.getParam("wp_paste_filters",!0)&&(tinymce.Env.webkit||a.on("PastePreProcess",function(e){e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2")}),a.on("PastePostProcess",function(e){tinymce.each(o.select("p",e.node),function(e){o.isEmpty(e)&&o.remove(e)})}))}),void 0!==window.jQuery&&a.on("keyup",function(e){e=e.keyCode||e.charCode;e!==n&&(13!==e&&8!==n&&46!==n||window.jQuery(document).triggerHandler("wpcountwords",[a.getContent({format:"raw"})]),n=e)}),a.on("SaveContent",function(e){a.inline||!a.isHidden()?(e.content=e.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),a.getParam("wpautop",!0)&&void 0!==window.switchEditors&&(e.content=window.switchEditors.pre_wpautop(e.content))):e.content=e.element.value}),a.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>(?:&nbsp;|\u00a0|\uFEFF| )+<\/p>/gi,"<p></p>"))}),a.on("preInit",function(){a.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b"),tinymce.Env.iOS&&(a.settings.height=300)}),e="alt+shift",a.addShortcut(e+"+c","","JustifyCenter"),a.addShortcut(e+"+r","","JustifyRight"),a.addShortcut(e+"+l","","JustifyLeft"),a.addShortcut(e+"+j","","JustifyFull"),a.addShortcut(e+"+q","","mceBlockQuote"),a.addShortcut(e+"+u","","InsertUnorderedList"),a.addShortcut(e+"+o","","InsertOrderedList"),a.addShortcut(e+"+n","","mceSpellCheck"),a.addShortcut(e+"+s","","unlink"),a.addShortcut(e+"+m","","WP_Medialib"),a.addShortcut(e+"+z","","WP_Adv"),a.addShortcut(e+"+t","","WP_More"),a.addShortcut(e+"+d","","Strikethrough"),a.addShortcut(e+"+h","","WP_Help"),a.addShortcut(e+"+p","","WP_Page"),a.addShortcut(e+"+x","","WP_Code"),a.addShortcut("ctrl+s","",function(){"undefined"!=typeof wp&&wp.autosave&&wp.autosave.server.triggerSave()}),a.on("init",function(){a.dom.bind(a.getWin(),"scroll",function(){r()}),a.dom.bind(a.getBody(),"dragstart",function(){r()})}),a.on("BeforeExecCommand",function(){r()}),a.on("SaveContent",function(){r()}),a.on("MouseDown",function(e){"IMG"!==e.target.nodeName&&r()}),a.on("keydown",function(e){e.which!==tinymce.util.VK.DELETE&&e.which!==tinymce.util.VK.BACKSPACE||r()}),{_showButtons:function(e,t){var n=a.dom.getViewPort(a.getWin()),o=i.getPos(a.getContentAreaContainer()),d=a.dom.getPos(e),e=Math.max(d.x-n.x,0)+o.x,o=Math.max(d.y-n.y,0)+o.y;i.setStyles(t,{top:o+5+"px",left:e+5+"px",display:"block"})},_hideButtons:r,_setEmbed:function(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.Env.transparentSrc+'" class="wp-oembed" alt="'+t+'" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />'})},_getEmbed:function(e){return e.replace(/<img[^>]+>/g,function(e){var t;return-1===e.indexOf('class="wp-oembed')||(t=e.match(/alt="([^\"]+)"/))[1]&&(e="[embed]"+t[1]+"[/embed]"),e})}}});